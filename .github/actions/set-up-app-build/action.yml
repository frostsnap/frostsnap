name: "App build preamble"
description: "Sets up common stuff for building the flutter app"

inputs:
  firmware_path:
    description: "Path to firmware.bin file"
    required: true

runs:
  using: "composite"
  steps:
    - uses: taiki-e/install-action@just
    - uses: dtolnay/rust-toolchain@stable
    - uses: subosito/flutter-action@v2
      with:
        channel: stable
        cache: true
    - uses: "./.github/actions/fetch-cargo-deps"
    - uses: "./.github/actions/fetch-dart-deps"
    - uses: "./.github/actions/generate-frb"
    - uses: "./.github/actions/install-cargo-bins"
    - name: Copy firmware to expected location
      shell: bash
      run: |
        mkdir -p target/riscv32imc-unknown-none-elf/release/
        cp "${{ inputs.firmware_path }}" target/riscv32imc-unknown-none-elf/release/firmware.bin
